/*! aotulog v1.0.0 | (c) 2017 l-zhi | MIT License | http://source.jd.com/app/aotulog_js */
!(function(e,t){function n(e){var t,o,i,a=arguments;if("define"===e||"require"===e){for(var c=1;c<a.length;c++)switch(typeof a[c]){case"string":t=a[c];break;case"object":o=a[c];break;case"function":i=a[c]}"require"===e&&(t&&!o&&(o=[t]),t=null),t=t||"#"+E++;var l;return L[t]?l=L[t]:(l={},L[t]=l),void(l.defined||(l.name=t,l.requires=o,l.creator=i,"define"===e&&(l.defining=!0),r(l)))}return"init"===e?void(n.config=Array.prototype.slice.call(a,1)):"function"==typeof e?void e(n):void String(e).replace(/^(?:([\w$_]+)\.)?(\w+)$/,(function(e,t,o){a[0]=o,p.apply(n.tracker(t),a)}))}function o(e){var n=_.get("alias")||{},o=n[e]||e+".js";if(!j[o]){j[o]=!0;var r=t.createElement("script"),i=t.getElementsByTagName("script")[0];r.async=!0,r.src=o,i.parentNode.insertBefore(r,i)}}function r(e){if(!e.defined){var t=!0,n=[],r=e.requires;if(r)for(var a=0;a<r.length;a++){var c=r[a],l=L[c]=L[c]||{};l.defined||l===e?n.push(l.instance):(t=!1,l.defining||o(c),l.waiting=l.waiting||{},l.waiting[e.name]=e)}t&&(e.defined=!0,e.creator&&(e.instance=e.creator.apply(e,n)),i(e))}}function i(e){for(var t in e.waiting)e.waiting.hasOwnProperty(t)&&r(e.waiting[t])}function a(e){return(e||new Date)-b}function c(e,t,o){if(e){"string"==typeof e&&(o=t,t=e,e=n);try{if(e===n)return S[t]=S[t]||[],void S[t].unshift(o);e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o)}catch(e){}}}function l(e,t,o){if(e){"string"==typeof e&&(o=t,t=e,e=n);try{if(e===n){var r=S[t];if(!r)return;for(var i=r.length;i--;)r[i]===o&&r.splice(i,1);return}e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent&&e.detachEvent("on"+t,o)}catch(e){}}}function s(e){var t=S[e];if(t){for(var n=[],o=arguments,r=1,i=o.length;r<i;r++)n.push(o[r]);for(var a=0,c=t.length;c--;)t[c].apply(this,n)&&a++;return a}}function d(e,o){if(e&&o){var r=t.createElement("img"),i=[];for(var a in o)o[a]&&("object"==typeof o[a]?temp=JSON.stringify(o[a]):temp=o[a],i.push(a+"="+encodeURIComponent(temp)));var c="img_"+ +new Date;n[c]=r,r.crossorigin="localhost",r.onload=r.onerror=function(){n[c]=r=r.onload=r.onerror=null,delete n[c]},r.src=e+(e.indexOf("?")<0?"?":"&")+i.join("&")+"&token="+A}}function f(e){A=e}function u(e,t){if(!e)return t;var n={};for(var o in t)null!==e[o]&&(n[e[o]||o]=t[o]);return n}function p(){var e=arguments,t=e[0];if(this.created||/^(on|un|set|get|create)$/.test(t)){for(var n=v.prototype[t],o=[],r=1,i=e.length;r<i;r++)o.push(e[r]);"function"==typeof n&&n.apply(this,o)}else this.argsList.push(e)}function g(e,t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function v(e){this.name=e,this.fields={protocolParameter:{postUrl:null,protocolParameter:null}},this.argsList=[],this.alog=n}function m(e){if("*"===(e=e||"default")){var t=[];for(var n in O)O.hasOwnProperty(n)&&t.push(O[n]);return t}return O[e]=O[e]||new v(e)}function h(){if(!(x&&new Date-w<50||k)){k=!0;var e=0;for(var t in O)if(O.hasOwnProperty(t)){var n=O[t];n.created&&(e+=n.fire("unload"))}if(e)for(var o=new Date;new Date-o<100;);}}var y=e.alogObjectName||"alog",T=e[y];if(!T||!T.defined){var w,A,k,_,x=e.attachEvent&&!window.opera,b=T&&T.l||+new Date,D=e.logId||(+new Date).toString(36)+Math.random().toString(36).substr(2,3),E=0,j={},L={alog:{name:"alog",defined:!0,instance:n}},S={},O={};if(window.test=[],v.prototype.create=function(e){if(!this.created){"object"==typeof e&&this.set(e),this.created=new Date,this.fire("create",this);for(var t;t=this.argsList.shift();)p.apply(this,t)}},v.prototype.send=function(e,t){var n=g({timestamp:t.timestamp||1*new Date,sid:t.sid||D,sy:t.sy||a()-(ATlog._storedDuration||0)},this.fields);if("object"==typeof t)n=g(n,t);else{var o=arguments;switch(e){case"pageview":o[1]&&(n.page=o[1]),o[2]&&(n.title=o[2]);break;case"event":o[1]&&(n.eventCategory=o[1]),o[2]&&(n.eventAction=o[2]),o[3]&&(n.eventLabel=o[3]),o[4]&&(n.eventValue=o[4]);break;case"timing":o[1]&&(n.timingCategory=o[1]),o[2]&&(n.timingVar=o[2]),o[3]&&(n.timingValue=o[3]),o[4]&&(n.timingLabel=o[4]);break;case"exception":o[1]&&(n.exDescription=o[1]),o[2]&&(n.exFatal=o[2]);break;default:return void(o[1]&&(n=o[1]))}}this.fire("send",n),d(this.fields.postUrl,u(this.fields.protocolParameter,n))},v.prototype.set=function(e,t){if("string"==typeof e)"protocolParameter"===e&&(t=g({postUrl:null,protocolParameter:null},t)),this.fields[e]=t;else if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&this.set(n,e[n])},v.prototype.get=function(e,t){var n=this.fields[e];return"function"==typeof t&&t(n),n},v.prototype.fire=function(e){for(var t=[this.name+"."+e],n=arguments,o=1,r=n.length;o<r;o++)t.push(n[o]);return s.apply(this,t)},v.prototype.on=function(e,t){n.on(this.name+"."+e,t)},v.prototype.un=function(e,t){n.un(this.name+"."+e,t)},n.name="alog",n.sid=D,n.defined=!0,n.timestamp=a,n.un=l,n.on=c,n.fire=s,n.tracker=m,n.setConfig=f,n("init"),_=m(),_.set("protocolParameter",{modules:null}),T){var P=[].concat(T.p||[],T.q||[]);T.p=T.q=null;for(var U in n)n.hasOwnProperty(U)&&(T[U]=n[U]);n.p=n.q={push:function(e){n.apply(n,e)}};for(var z=0;z<P.length;z++)n.apply(n,P[z])}e[y]=n,e[y].util={timestamp:a,merge:g,ie:x},x&&c(t,"mouseup",(function(e){var t=e.target||e.srcElement;1===t.nodeType&&/^ajavascript:/i.test(t.tagName+t.href)&&(w=new Date)})),c(e,"beforeunload",h),c(e,"unload",h)}})(window,document),(function(e,t){function n(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var r="; expires="+o.toGMTString();document.cookie=e+"="+t+r+"; path=/"}function o(e){for(var t=e+"=",n=document.cookie.split(";"),o=0,r=n.length;o<r;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}function r(){return h(d+"id")||i()}function i(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}function a(){document[j]?ATlog._stopTime():ATlog._startTime(),ATlog.report("onchange")}var c=ATlog.util,l="ontouchstart"in document,s="touchend";l||(s="mouseup");var t=document,d="ATlog_",f="//quark.jd.com/atlog",u=0,p=0,g=0,v=0,m=0,h=function(e,t,r){r=r||!1;var i,a=!1;if("undefined"!=typeof localStorage){a=!0;try{localStorage.setItem("testLocal",!0)}catch(e){a=!1}}if(void 0!==t&&null!==t&&("object"==typeof t&&(t=JSON.stringify(t)),a?localStorage.setItem(e,t):r||n(e,t,30)),void 0===t){a?i=localStorage.getItem(e):r||(i=o(e));try{i=JSON.parse(i)}catch(e){i=i}return i}null===t&&(a?localStorage.removeItem(e):r||n(e,"",-1))},y=function(e){var n="//quark.jd.com/log.gif",r="";"string"!=typeof e&&"number"!=typeof e||(r=e+""),"object"!=typeof e&&(e=!1),e=e||{},e.uid||(e.uid=r||o("pin")||"");var i=t.createElement("img"),a=[];for(var c in e)e[c]&&a.push(c+"="+encodeURIComponent(e[c]));var l=(new Date,i);i.onload=i.onerror=function(){l=i=i.onload=i.onerror=null,delete l};var s="";a.length&&(s=(n.indexOf("?")<0?"?":"&")+a.join("&")),i.src=n+s};if(function(){u=t.documentElement.clientWidth,p=t.documentElement.clientHeight,g=r(),h(d+"id",g),v=o("pin")||"",m=(new Date).getTimezoneOffset()}(),ATlog&&ATlog.config&&(ATlog.config.length||ATlog.config[0].app_key)){var T=0;ATlog.config.length>0&&(T={app_key:ATlog.config[0],clickEvents:ATlog.config[1],mta:ATlog.config[2]}),"object"==typeof ATlog.config[0]&&(T=ATlog.config[0]);var w="cj3xr6lv200000f65xvv97nwc",A=T.app_key,k=!!T.clickEvents,y=!!T.mta;if("fqve77zqhfs"===A)return;ATlog.setConfig(w),n("ATlogtoken",w);if(y){window._mtac={performanceMonitor:1,senseQuery:1};var _=document.createElement("script");_.src="//pingjs.qq.com/h5/stats.js?v2.0.4",_.setAttribute("name","MTAH5"),_.setAttribute("sid","500470721"),_.setAttribute("cid","500470727");var x=document.getElementsByTagName("script")[0];x.parentNode.insertBefore(_,x)}var b=function(e){if(y)try{setTimeout((function(){window.MtaH5&&window.MtaH5.clickStat((A||"__")+e)}),16)}catch(e){console.info("MTA 配置失败")}};ATlog("define","pageview",(function(){var e=ATlog.tracker("pageview"),t={action:"pageview",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};e.create({postUrl:f}),e.on("report",(function(n){e.send("pageview",t)}))})),ATlog("define","interaction",(function(){var e=ATlog.tracker("interaction"),t=[],n={action:"interaction",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0,coord:[],domready:0,onload:0,topscreen:0,stay:0};e.create({postUrl:f}),k&&e.on("click",(function(e,n){t.push([e,n])})),e.set("protocolParameter",{atonload:null,atdomready:null,attopscreen:null}),e.on("save",(function(){n.coord=t,n.stay=c.timestamp()-(ATlog._storedDuration||0)})),e.on("report",(function(t){e.fire("save");var o={};"new"===t&&(o.insertType=1),o=n,k&&(o.coord=n.coord),e.send("pageview",o)}))})),ATlog("define","page",(function(){var e=ATlog.tracker("page"),t={action:"page",width:u,height:p,device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0,domready:0,onload:0};e.create({postUrl:f}),e.set("protocolParameter",{atonload:null,atdomready:null}),e.on("save",(function(){t.onload=e.get("atonload")?c.timestamp(e.get("atonload")):0,t.domready=c.timestamp(e.get("atdomready"))||0})),e.on("report",(function(n){e.fire("save");var o=t;e.send("pageview",o)}))})),ATlog("define","stay",(function(){var e=ATlog.tracker("stay"),t={action:"stay",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};e.create({postUrl:f}),e.on("report",(function(n){n||(n="report"),t.oragin=n;var o=t;e.send("pageview",o)}));var n=function(){setTimeout((function(){t.sy=c.timestamp()-(ATlog._storedDuration||0),t.sid=ATlog.sid,t.timestamp=1*new Date,h(d+"stay",t),n()}),3600)};e.on("checkstore",(function(){var t=h(d+"stay");t&&(t.oragin="localstorage",h(d+"stay",null),e.send("pageview",t)),n()})),e.on("unload",(function(){ATlog("stay.fire","report","unload")}))})),ATlog("define","topscreen",(function(){var e=ATlog.tracker("topscreen"),t={action:"topscreen",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};e.create({postUrl:f}),e.on("report",(function(n){n&&(t.topscreen=c.timestamp(n||new Date),e.send("event",t))}))})),ATlog("define","click",(function(){var e=ATlog.tracker("click"),t={action:"click",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};e.create({postUrl:f}),e.on("report",(function(n){n&&(t.tag=n||"",e.send("event",t)),b(n)}))})),ATlog("define","swipe",(function(){var e=ATlog.tracker("swipe"),t={action:"swipe",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};e.create({postUrl:f}),e.on("report",(function(n){n&&(t.page=n||"",e.send("event",t)),b("swipe-"+n)}))})),ATlog("define","error",(function(){var e=0,t=ATlog.tracker("error"),n={action:"error",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};t.create({postUrl:f}),t.on("report",(function(o,r){++e>60||(o||r)&&(n.msg=o||"",n.stacktrace=r||"",t.send("exception",n),b("error-"+r))}))})),ATlog("define","custom",(function(){function e(e){return"string"==typeof e?{msg:e}:"number"==typeof e?{count:e}:"object"==typeof e&&e.length?{list:e}:"object"==typeof e&&!e.length&&e}var t=ATlog.tracker("custom"),n={action:"custom",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};t.create({postUrl:f}),t.on("report",(function(){var o,r,i;if(arguments.length<2)return void console.warn("custom 错误上报，参数必须大于2个");2===arguments.length?(o=arguments[0],r=!1,i=arguments[1]):(o=arguments[0],r=arguments[1],i=arguments[2]),n.condition=e(r),n.type="c_"+o,n.data=e(i),o&&i&&(t.send("event",n),b(JSON.stringify({type:o,condition:r,data:i})))}))})),ATlog("define","share",(function(){var e=ATlog.tracker("share"),t={action:"share",device_id:g,app_key:A,title:document.title||"",uid:v,tz:m||0};e.create({postUrl:f}),e.on("report",(function(n){if(n){if(t.type=n,e.send("share",t),!y)return;try{setTimeout((function(){window.MtaH5&&window.MtaH5.clickShare(n)}),16)}catch(e){console.info("MTA 配置失败")}}}))})),ATlog.topscreen=function(e){e=e&&e.constructor===Date?e:e&&+e>0?new Date(+e):new Date,ATlog("topscreen.fire","report",e)},ATlog.swipe=function(e){e&&e>0&&ATlog("swipe.fire","report",e)},ATlog.custom=function(e,t,n){n?ATlog("custom.fire","report",e,t,n):ATlog("custom.fire","report",e,t)},ATlog.click=function(e){e&&ATlog("click.fire","report",e)},ATlog.share=function(e){e&&ATlog("share.fire","report",e)},ATlog.report=function(e){ATlog("stay.fire","report",e||0)},ATlog._storedDuration=0,ATlog._lastBeat=1*new Date,ATlog._startTime=function(){ATlog._storedDuration=1*new Date-ATlog._lastBeat+ATlog._storedDuration,console.info("ATlog._storedDuration",ATlog._storedDuration)},ATlog._stopTime=function(){ATlog._lastBeat=1*new Date}}else console.warn("ATlog 引用方式错误");var D=performance.timing||0,E={error:function(e){ATlog("error.fire","report",e.error,e.message)},eventClick:function(e){var t=function(e,n){if((n=n||0)>3)return!1;var o=e&&e.getgetAttribute&&e.getAttribute("data-attag")||e&&e.dataset&&e.dataset.attag;return o||!(!e||!e.parentNode)&&t(e.parentNode,++n)},n=t(e.target);n&&ATlog("click.fire","report",n)},load:function(){D&&ATlog("page.set","atdomready",D.domContentLoadedEventStart),ATlog("page.set","atonload",new Date),window.removeEventListener("load",E.load),setTimeout((function(){ATlog("page.fire","report")}),16)}};window.addEventListener("load",E.load),window.addEventListener("error",E.error);var j="hidden";j in document?document.addEventListener("visibilitychange",a):(j="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(j="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(j="msHidden")in document?document.addEventListener("msvisibilitychange",a):on(e,"pagehide",unloadHandler),document.addEventListener(s,E.eventClick),ATlog("pageview.fire","report"),ATlog("stay.fire","checkstore")})(window,document);