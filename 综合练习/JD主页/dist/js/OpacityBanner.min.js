define(["Util"],function(t){function i(n){if(this.config=t.deepCopy(n,t.deepCopy(e)),!(this instanceof i))return new i(n);this.cur_index=4,this.banner_con=null,this.banners=null,this.circles=null,this.prev_button=null,this.next_button=null,this.animateTimer=null,this.autoPlayTimer=null,this.step=0,this.total=this.config.steps,this.interval=this.config.interval,this.isHaveButtons=!0,this.ie6=!-[1]&&!window.XMLHttpRequest,this.init(n)}var e={steps:20,interval:2e3};return i.prototype.init=function(i){var e=this.banner_con=t.$$(i.id||"main_banner");this.cur_index=i.index||0,this.banners=t.$(i.itemClass||"item",e),this.circles=t.$("circle",e),this.prev_button=t.$("prev",e)[0],this.next_button=t.$("next",e)[0],this.isHaveButtons=!!this.prev_button,this.initUI(),this.initEvent()},i.prototype.initUI=function(){var i=this.banners;if(this.ie6){for(e=0;e<i.length;e++)t.addClass(i[e],"hide");t.removeClass(i[this.cur_index],"hide")}else{for(e=0;e<i.length;e++)t.removeClass(i[e],"hide"),i[e].style.opacity=0,i[e].style.filter="alpha(opacity=0)";i[this.cur_index].style.opacity=1,i[this.cur_index].style.filter="alpha(opacity=100)"}for(var e=0;e<this.circles.length;e++)this.circles[e].index=e,t.removeClass(this.circles[e],"active");t.addClass(this.circles[this.cur_index],"active"),this.initButtons(!1)},i.prototype.initButtons=function(t){if(this.isHaveButtons){if(t)return this.prev_button.style.display="block",void(this.next_button.style.display="block");this.prev_button.style.display="none",this.next_button.style.display="none"}},i.prototype.initEvent=function(){var t=this;this.banner_con.onmouseover=function(){t.stopPlay(),t.initButtons(!0)},this.banner_con.onmouseout=function(){t.autoPlay(),t.initButtons(!1)},this.isHaveButtons&&(this.prev_button.onclick=function(){t.prev()},this.next_button.onclick=function(){t.next()});for(var i=0;i<this.circles.length;i++)this.circles[i].onclick=function(){t.focus(this.index)}},i.prototype.focusCircle=function(i){t.removeClass(this.circles[this.cur_index],"active"),t.addClass(this.circles[i],"active")},i.prototype.focus=function(i){var e=this,n=this.banners;if(this.ie6)return e.focusCircle(i),t.removeClass(n[i],"hide"),t.addClass(n[this.cur_index],"hide"),void(e.cur_index=i);n[this.cur_index].style.zIndex=2,n[i].style.zIndex=1,n[i].style.opacity=0,n[i].style.filter="alpha(opacity=100)",e.focusCircle(i),clearInterval(this.animateTimer),this.animateTimer=setInterval(function(){e.step++,n[e.cur_index].style.opacity=1-e.step/e.total,n[e.cur_index].style.filter="alpha(opacity="+parseInt(100-100*e.step/e.total)+")",n[i].style.opacity=e.step/e.total,n[i].style.filter="alpha(opacity="+parseInt(100*e.step/e.total)+")",e.step==e.total&&(n[e.cur_index].style.zIndex=0,n[i].style.zIndex=0,clearInterval(e.animateTimer),e.step=0,e.cur_index=i)},17)},i.prototype.next=function(){var t=this.cur_index+1;t>this.banners.length-1&&(t=0),this.focus(t)},i.prototype.prev=function(){var t=this.cur_index-1;t<0&&(t=this.banners.length-1),this.focus(t)},i.prototype.stopPlay=function(){clearInterval(this.autoPlayTimer)},i.prototype.autoPlay=function(){var t=this;this.autoPlayTimer=setInterval(function(){t.next()},this.interval)},i});